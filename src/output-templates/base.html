<html>
<header>
	<style>
        *{
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

		html {
			margin: 10%;
            margin-top: 20px;
		}

		#instruction {
			border: 2px solid black;
			border-radius: 5px;
			padding: 5px 15px;
			min-height: 10px;
            background-color: #faf3ee;
		}
 
		h5 {
			font-weight: normal;

			margin: 0 0 0 0;
			padding: 0 0 0 0;
		}

		h3{
            margin-bottom: 5px;
            margin-top: 35px;
        }
		h4{
            margin: 5px 0 5px 0;
        }
		h5 {
			margin: 25px 0 5px 0;
			padding: 0 0 0 0;
		}

        h3:first-of-type{
            margin: 10px 0 5px 0;
        }

		a {
			font-style: normal
		}

		.colltext {
			display: block;
			color: darkslategray;  
			margin: 5px 10px;
			font-style: italic;
			cursor: context-menu;
		}

		.collapsible {
            padding-left: 10px;
            float: left;
		}
        .wrapper {
            overflow: hidden; /* add this to contain floated children */
            position: relative;
        }
        .time-header {
            margin-left: 10px;
            margin-right: 5px;
            font-weight: bold;
            float:left; 
        }
        .time-content {
            float: left; 
            margin-right: 20px;
        }
        #titleDiv{
            float:left; 
            margin-bottom: 10px;
            margin-left: 10px;
        }
        #servingsDiv{
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .leftHalf{
            float: left;
            margin-right: 5%;
            width: calc(15% - 10px);
            margin-left: 10px;
        }
        .rightHalf{
            float: left;
            width: calc(80% - 10px);
            margin-right: 10px;
        }
        .arrow-down {
            width: 0; 
            height: 0; 
            float: left;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #d7d7d7;
        }
        .collapsible-wrapper:hover>.arrow-down{
            border-top-color: #898989;
        }
        .collapsible-wrapper{
            align-items: center;
            display: flex;
            cursor: pointer;
            user-select: none;
        }
        .collapsible-body{
            margin-bottom: 30px;
        }
        #description{
            padding-left: 10px;
            float: left;
        }
        .restoreDefaultAmount, .collapseAllButton{
            float: right;
            margin-right: 10px;
            width: 100px;
        }
        .servings{
            width: 50px;

            
        }
	</style>
</header>
<div class="wrapper">
    <h1 id="titleDiv">
        ~title~
    </h1>
    <div id="servingsDiv">
    ~servings~
    </div>
</div>
<hr>
<div class="wrapper">
    ~total-time~
    ~prep-time~
    ~cook-time~
    <button class = collapseAllButton onclick="collapseOrExpand()" > Collapse All </button>
    <button class = restoreDefaultAmount onclick="restoreDefaultAmount()" > Reset Amount </button>
</div>
<hr>
<div class="wrapper">
    <div class="leftHalf">
        <div>
            <!--
            <form>
                <input type="radio" id="original" name="measurementSysten" value="original">
                <label for="html">Original</label><br>
                <input type="radio" id="metric" name="measurementSysten" value="metric">
                <label for="css">Metric</label><br>
                <input type="radio" id="imperial" name="measurementSysten" value="imperial">
                <label for="javascript">Imperial</label>
            </form>
            -->
        </div>  
        ~ingredients~
		~optionalIngredients~
        ~kitchenware~
        ~tags~
    </div>
    <div class="rightHalf">
        <div class="collapsible-wrapper">
            <div class="arrow-down"></div>
            <h3 class="collapsible">
                Description
            </h3>
        </div>
        <div class="collapsible-body">
            ~description~
        </div>
    
        <!-- steps -->
        ~instructions~
    
        <script>
            let collapsed = false;
            const allHeaders = document.getElementsByClassName("collapsible-wrapper");
            const allSteps = document.getElementsByClassName("collapsible-body");
            const allArrows = document.getElementsByClassName("arrow-down");
            const collapseAllButton = document.getElementsByClassName("collapseAllButton")[0];
            const resetAmountButton = document.getElementsByClassName("restoreDefaultAmount")[0];
            const allNumbers = document.getElementsByClassName("number");
            let allDefaultNumbers = [];
            const servingsField = document.getElementsByClassName("servings")[0];
            let defaultAmount = servingsField.value;

            for (i = 0; i < allHeaders.length; i++) {
                const header = allHeaders[i];
                const step = allSteps[i];
                const arrow = allArrows[i];

                header.addEventListener("click", (ev) => {
                    if(step.style.display == "none"){
                        step.style.display = "block";
                        arrow.style.transform = "rotate(0deg)";
                    }
                    else {
                        step.style.display = "none";
                        arrow.style.transform = "rotate(-90deg)";
                    }
                        
                    checkCollapseStatus();
                });
                
                // check if all headers are collapsed
            }

        function collapseOrExpand(){
            if (collapsed){
                expandAll();
            }
            else {
                collapseAll();
            }
            checkCollapseStatus();
        }

        function checkCollapseStatus(){
            oneIsNotCollapsed = false;
            for (j = 0; j < allHeaders.length; j++) {
                if (allSteps[j].style.display == "block"){
                    oneIsNotCollapsed = true;
                }
            }

            if(oneIsNotCollapsed){
                collapsed = false;
            }
            else {
                collapsed = true;
            }

            if(collapsed){
                collapseAllButton.innerHTML = "Expand All";
            }
            else {
                collapseAllButton.innerHTML = "Collapse All";
            }
        }

        function collapseAll(){
            collapsed = true;

            for (i = 0; i < allHeaders.length; i++) {
                const header = allHeaders[i];
                const step = allSteps[i];
                const arrow = allArrows[i];

                step.style.display = "none";
                arrow.style.transform = "rotate(-90deg)";
            }
        }

        function expandAll(){
            collapsed = false;
            
            for (i = 0; i < allHeaders.length; i++) {
                const header = allHeaders[i];
                const step = allSteps[i];
                const arrow = allArrows[i];

                step.style.display = "block";
                arrow.style.transform = "rotate(0deg)";
            }
        }

        function truncate(){
            value = parseInt(servingsField.value);
            max = parseInt(servingsField.max);
            min = parseInt(servingsField.min);
            if(value > max){
                servingsField.value = inservingsFieldputField.max;
            }
            else if(value < min){
                servingsField.value = servingsField.min;
            }
        }

        invalidChars = [
        "-",
        "+",
        "e",
        ","
        ];

        servingsField.addEventListener("keydown", e => {
        if (invalidChars.includes(e.key)) {
            e.preventDefault();
        }
        })

        function updateNumbers(){
            truncate();

            if (servingsField.value != ""){
                for (i = 0; i < allNumbers.length; i++) {
                    let newNumber = (allDefaultNumbers[i] * parseFloat(servingsField.value));
                    newNumber = Math.round((newNumber + Number.EPSILON)* 100.0) / 100.0;
                    allNumbers[i].innerHTML = newNumber.toString();
                }
            }
        }

        function saveStartValues(){
            for (i = 0; i < allNumbers.length; i++) {
                let defaultNumber = parseFloat(allNumbers[i].innerHTML) / defaultAmount;
                allDefaultNumbers.push(defaultNumber);
            }
        }
        saveStartValues();

        function restoreDefaultAmount(){
            servingsField.value = defaultAmount.toString();
            updateNumbers(servingsField);
        }

        </script>
    </div>
</div>

</html>